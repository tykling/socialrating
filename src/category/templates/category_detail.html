{% extends 'base.html' %}
{% load guardian_tags %}

{% block team_content %}
{% get_obj_perms request.user for category as "category_perms" %}
<p class="lead">Details for category {{ category.name }}
{% if "change_category" in category_perms %}
  <a href="{% url 'team:category:update' team_slug=team.slug category_slug=category.slug %}" class="btn btn-primary btn-xs"><i class="fas fa-edit"></i> Update</a>
{% endif %}
</p>

<p>{{ category.description }}</p>

{% if category.facts.all %}
 <table class="table table-bordered">
    <thead>
      <tr>
        <th>Fact Name</th>
        <th>Fact Description</th>
        <th>Fact Type</th>
        <th>Fact Required?</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for fact in category.facts.all %}
      {% get_obj_perms request.user for fact as "fact_perms" %}
      {% if "view_attribute" in fact_perms %}
      <tr>
        <td>{{ fact.name }}</td>
        <td>{{ fact.description }}</td>
        <td>{{ fact.datatype }}</td>
        <td>{{ fact.required }}</td>
        <td>
          <a href="{% url 'team:category:fact:detail' team_slug=team.slug category_slug=category.slug fact_slug=fact.slug %}" class="btn btn-primary"><i class="fas fa-search"></i> Details</a>
          {% if "change_attribute" in fact_perms %}
            <a href="{% url 'team:category:fact:update' team_slug=team.slug category_slug=category.slug fact_slug=fact.slug %}" class="btn btn-primary"><i class="fas fa-edit"></i> Update</a>
          {% endif %}
          {% if "delete_attribute" in fact_perms %}
            <a href="{% url 'team:category:fact:delete' team_slug=team.slug category_slug=category.slug fact_slug=fact.slug %}" class="btn btn-danger"><i class="fas fa-times"></i> Delete</a>
          {% endif %}
        </td>
      </tr>
      {% endif %}
    {% endfor %}
    </tbody>
</table>
{% else %}
<p class="lead">No Facts found for this Category.</p>
{% endif %}
{% if perms.eav.add_attribute %}
  <a href="{% url 'team:category:fact:create' team_slug=team.slug category_slug=category.slug %}" class="btn btn-success">Create new Fact</a>
{% endif %}

<hr>

{% if category.ratings.all %}
<p>
<table class="table table-bordered">
    <thead>
      <tr>
        <th>Rating Name</th>
        <th>Rating Description</th>
        <th>Max Rating</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for rating in category.ratings.all %}
      {% get_obj_perms request.user for rating as "rating_perms" %}
      {% if "view_rating" in rating_perms %}
      <tr>
        <td>{{ rating.name }}</td>
        <td>{{ rating.description }}</td>
        <td>{{ rating.max_rating }}</td>
        <td>
          <a href="{% url 'team:category:rating:detail' team_slug=team.slug category_slug=category.slug rating_slug=rating.slug %}" class="btn btn-primary"><i class="fas fa-search"></i> Details</a>
          {% if "change_rating" in rating_perms %}
            <a href="{% url 'team:category:rating:update' team_slug=team.slug category_slug=category.slug rating_slug=rating.slug %}" class="btn btn-primary"><i class="fas fa-edit"></i> Update</a>
          {% endif %}
          {% if "delete_rating" in rating_perms %}
            <a href="{% url 'team:category:rating:delete' team_slug=team.slug category_slug=category.slug rating_slug=rating.slug %}" class="btn btn-danger"><i class="fas fa-times"></i> Delete</a>
          {% endif %}
        </td>
      </tr>
      {% endif %}
    {% endfor %}
    </tbody>
</table>
{% else %}
<p class="lead">No ratings found for this category.</p>
{% endif %}
{% if perms.rating.add_rating %}
  <a href="{% url 'team:category:rating:create' team_slug=team.slug category_slug=category.slug %}" class="btn btn-success"><i class="fas fa-plus"></i> Create new Rating</a>
{% endif %}
{% endblock team_content %}

